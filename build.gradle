buildscript {
  ext {
    indraVersion = "1.2.1"
  }
}

plugins {
  id 'net.kyori.invent' version '1.0.4'
  id 'net.kyori.invent-javadoc-jar' version '1.0.4'
  id 'net.kyori.invent-sonatype-repository' version '1.0.4'
  id 'net.kyori.invent-sources-jar' version '1.0.4'
  id 'org.xbib.gradle.plugin.jflex' version '1.4.0'
  id 'net.minecrell.licenser' version '0.4.1'
  id 'java-library'
  id 'maven-publish'
  id 'signing'
}

// Adventure version
ext.adventure = "4.1.1"

group 'net.kyori'
version '4.1.0-SNAPSHOT'
description 'A string-based, user-friendly format for representing Minecraft: Java Edition chat components.'

repositories {
  mavenLocal()
  mavenCentral()
  sonatypeSnapshots()
}

dependencies {
  api "net.kyori:adventure-api:${adventure}"
  testImplementation "net.kyori:adventure-text-serializer-plain:${adventure}"
  testImplementation "net.kyori:adventure-text-serializer-gson:${adventure}"
  testImplementation "org.junit.jupiter:junit-jupiter-api:5.7.0"
  testImplementation "org.junit.jupiter:junit-jupiter-engine:5.7.0"
}

indra {
  javaVersions {
    testWith(8, 11, 15)
  }

  github("KyoriPowered", "adventure-text-minimessage") {
    ci = true
  }
  mitLicense()

  configurePublications {
    pom {
      developers {
        developer {
          id = "minidigger"
          name = "MiniDigger"
        }
      }
    }
  }
}

sourceSets {
  main {
    java {
      // JFlex output
      srcDir "build/generated-src"
    }
  }
}

tasks.compileJava {
    // Generated JFlex source uses fall-throughs heavily
    options.compilerArgs << "-Xlint:-fallthrough"
}

license {
  exclude("**/MiniMessageLexer.java")
}

jar {
  manifest.attributes(
    "Automatic-Module-Name": "net.kyori.adventure.text.minimessage"
  )
}
